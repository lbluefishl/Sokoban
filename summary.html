<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Summary Page</title>
  <link rel="icon" href="images/shortcut.png">
</head>

<body>

  <!DOCTYPE html>
  <html>

  <head>
    <title>Survey</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        padding: 0;
        background-color: #f0f0f0;
      }

      form {
        max-width: 800px;
        margin: 0 auto;
        padding: 30px;
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      label {
        font-weight: bold;
      }

      select,

      textarea,
      button {
        display: block;
        margin-bottom: 15px;
      }

      div {
        margin: 10px;
      }

      select,
      textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 3px;
        margin: 10px;
      }

      button {
        background-color: #007bff;
        color: #fff;
        padding: 10px 20px;
        border: none;
        margin: auto;
        border-radius: 3px;
        cursor: pointer;
      }

      button:hover {
        background-color: #0056b3;
      }

      .radio-group {

        flex-direction: column;
        padding: 10px;
      }
    </style>
  </head>

  <body>
    <h1 style="text-align: center;">Survey </h1>
    <form id="surveyForm">
      <label for="age">What is your age in years?</label>
      <div class="radio-group"><input type="number" id="age" name="age" required placeholder="Enter your age"></div>



      <label for="sex">What sex were you assigned at birth?</label>
        <div class="radio-group">
          <input type="radio" name="sex" value="0" required>Female</option>
          <input type="radio" name="sex" value="1">Male</option>
          <input type="radio" name="sex" value="2">Other</option>
        </div>


      

      <label for="handedness">Which hand do you normally write with?</label>
      <div class="radio-group">
        <input type="radio" name="handedness" value="left" required> Left
        <input type="radio" name="handedness" value="right"> Right
        <input type="radio" name="handedness" value="both"> Both equally
      </div>
<hr>

       <h3> On a typical day, how often do you...?</h3>
      <table>
        <tr>
            <td><label for="digitalDeviceHours">Use digital devices (smartphone, tablet, computer) for any purpose</label></td>
            <td>
                <select name="digitalDeviceHours" required>
                    <option value="" disabled selected>Select an option</option>
                    <option value="lessThan1">Less than 1 hour</option>
                    <option value="1to2">1-2 hours</option>
                    <option value="3to4">3-4 hours</option>
                    <option value="5plus">5+ hours</option>
                </select>
            </td>
        </tr>
        <tr>
          <td><label for="smartphoneHours">Go on your smartphone for any purpose</label></td>
          <td>
              <select name="smartphoneHours" required>
                  <option value="" disabled selected>Select an option</option>
                  <option value="lessThan1">Less than 1 hour</option>
                  <option value="1to2">1-2 hours</option>
                  <option value="3to4">3-4 hours</option>
                  <option value="5plus">5+ hours</option>
              </select>
          </td>
      </tr>
        <tr>
            <td><label for="videoGameHours">Play video games</label></td>
            <td>
                <select name="videoGameHours" required>
                    <option value="" disabled selected>Select an option</option>
                    <option value="lessThan1">Less than 1 hour</option>
                    <option value="1to2">1-2 hours</option>
                    <option value="3to4">3-4 hours</option>
                    <option value="5plus">5+ hours</option>
                </select>
            </td>
        </tr>
        <tr>
            <td><label for="shortFormVideoHours">Watch short form videos (TikTok, YouTube Shorts, Instagram Reels)</label></td>
            <td>
                <select name="shortFormVideoHours" required>
                    <option value="" disabled selected>Select an option</option>
                    <option value="lessThan1">Less than 1 hour</option>
                    <option value="1to2">1-2 hours</option>
                    <option value="3to4">3-4 hours</option>
                    <option value="5plus">5+ hours</option>
                </select>
            </td>
        </tr>

    </table>
    <hr>

      <label for="sokobanFamiliarity">How familiar are you with Sokoban or Sokoban-like games?</label>
      <select name="sokobanFamiliarity" required>
        <option value="" disabled selected>Select an option</option>
        <option value="notFamiliar">Not familiar</option>
        <option value="somewhatFamiliar">Somewhat familiar</option>
        <option value="veryFamiliar">Very familiar</option>
      </select>


      <label for="comments">Do you have any comments or feedback for the study? Please describe any technical issues,
        annoyances, or unique experiences, if any.</label>
      <textarea id="comments" name="comments"></textarea>



      <p>Thank you for participating in this study. If you would like to play continously on the puzzles shown in this study and additional ones, feel free to 
        <a href="index.html" target="_blank">click here</a>.
         The link will open in a new tab. Please press submit to complete the study to obtain credit for Prolific.</p>

      <button type="submit">Submit</button>
    </form>


    <script>
      const form = document.getElementById('surveyForm');
      var isRedirecting = false;

      form.addEventListener("submit", function (event) {
        event.preventDefault();

        // Get the form values
        const age = document.querySelector('input[name="age"]').value;
        const sex = document.querySelector('input[name="sex"]:checked').value;
        const handedness = document.querySelector('input[name="handedness"]:checked').value;
        const shortFormVideoHours = document.querySelector('select[name="shortFormVideoHours"]').value;
        const videoGameHours = document.querySelector('select[name="videoGameHours"]').value;
        const smartphoneHours = document.querySelector('select[name="smartphoneHours"]').value;
        const sokobanFamiliarity = document.querySelector('select[name="sokobanFamiliarity"]').value;
        const digitalDeviceHours = document.querySelector('select[name="digitalDeviceHours"]').value;
        const comments = document.querySelector('textarea[name="comments"]').value;
        const prolificPID = localStorage.getItem('prolificPID');
        const studyID = localStorage.getItem('studyID');
        const sessionID = localStorage.getItem('sessionID');
        const trialOrder = JSON.parse(localStorage.getItem('trialOrder').map(arr => [arr.join('')]));
        const conditionOrder = JSON.parse(localStorage.getItem('conditionOrder').map(arr => [arr.join('')]));
        const completedAllLevels = localStorage.getItem('completedAllLevels');
        const idleTime = localStorage.getItem('idleTime');
        const playerId = localStorage.getItem('playerId');


        // Create the data object to be sent to the server
        const data = {
          age: age,
          sex: sex,
          handedness: handedness,
          videoGameHours: videoGameHours,
          smartphoneHours: smartphoneHours,
          shortFormVideoHours: shortFormVideoHours,
          sokobanFamiliarity: sokobanFamiliarity,
          digitalDeviceHours: digitalDeviceHours,
          comments: comments,
          playerId: playerId,
          prolificPID: prolificPID,
          studyID: studyID,
          sessionID: sessionID,
          conditionOrder: conditionOrder,
          trialOrder: trialOrder,
          completedAllLevels: completedAllLevels,
          idleTime: idleTime

        };

        // Send the data to the server using fetch
        fetch('https://sokoban-badc101a491f.herokuapp.com/submit-summary', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        })
          .then(response => {
            if (response.ok) {
              console.log('Survey data submitted successfully!');
            } else {
              console.log('Error submitting survey data:', response.status);
            }
            alert('You have completed the study. You will now be directed back to Prolific.')
            localStorage.clear();
            isRedirecting = true;
            window.location.href = "https://app.prolific.com/submissions/complete?cc=CVBVQUIN";

          })
          .catch(error => {
            console.error('Error submitting survey data:', error);
          });
      });

      window.addEventListener("beforeunload", function (e) {
        if (!isRedirecting) {
          // Display a confirmation message
          e.preventDefault();
          var confirmationMessage = "This experiment must be done in one sitting continuously. If you refresh the page or go back, the study will end and you will not be compensated for your time.";

          // Set the confirmation message for modern browsers
          e.returnValue = confirmationMessage;

          // For older browsers
          return confirmationMessage;
        }
      });
    </script>
  </body>

  </html>




</body>

</html>